{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SecureVibes Eval Task",
  "description": "Schema for eval task definition files",
  "type": "object",
  "required": ["id", "name", "category", "fixture", "graders"],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique task identifier",
      "pattern": "^[a-z0-9-]+$"
    },
    "name": {
      "type": "string",
      "description": "Human-readable task name",
      "minLength": 1
    },
    "description": {
      "type": "string",
      "description": "Detailed description of what the task tests"
    },
    "category": {
      "type": "string",
      "enum": ["capability", "regression"],
      "description": "Task category"
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Tags for filtering tasks"
    },
    "fixture": {
      "type": "object",
      "required": ["source"],
      "properties": {
        "source": {
          "type": "string",
          "description": "Path to fixture directory relative to fixtures/"
        },
        "setup_commands": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Commands to run before scanning"
        }
      }
    },
    "scanner_options": {
      "type": "object",
      "properties": {
        "model": {"type": "string"},
        "agentic": {"type": "boolean"},
        "dast_enabled": {"type": "boolean"},
        "dast_target_url": {"type": "string"}
      }
    },
    "expected_outcome": {
      "type": "object",
      "properties": {
        "vulnerabilities": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "threat_id_pattern": {"type": "string"},
              "title_contains": {
                "type": "array",
                "items": {"type": "string"}
              },
              "severity": {
                "type": "array",
                "items": {"type": "string"}
              },
              "cwe_id": {"type": "string"},
              "file_path_contains": {"type": "string"},
              "has_code_snippet": {"type": "boolean"},
              "has_recommendation": {"type": "boolean"}
            }
          }
        },
        "no_vulnerabilities_matching": {
          "type": "array",
          "items": {"type": "object"}
        },
        "artifacts_exist": {
          "type": "array",
          "items": {"type": "string"}
        }
      }
    },
    "graders": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["type"],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "artifact_exists",
              "json_schema",
              "vulnerability_match",
              "no_false_positive",
              "tool_calls",
              "llm_rubric"
            ]
          }
        }
      }
    },
    "tracked_metrics": {
      "type": "array",
      "items": {
        "type": "string",
        "enum": [
          "n_turns",
          "n_tool_calls",
          "total_tokens",
          "scan_time_seconds",
          "cost_usd"
        ]
      }
    }
  }
}
